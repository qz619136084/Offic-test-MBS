$(function(){async function e(e,r,a){var[i,o]=await Promise.all([DYO.waitForElementAsync(e),DYO.waitForElementAsync(r)]),n=[];o.forEach(function(e,r){var i=null,o=null,l=null,s=$(e);if(a)if($("#select_room_container").length){console.log("single room card");var c=s.closest(".packageList_item").find(".packageList_item_title").text().trim(),d=f_getCurrencyInfo().code,u=curr_availableRateplans.offerList.filter(e=>e.name===c)[0].rooms[0].discountedAveragePriceByCurrency;o=f_getCurrencyInfo().symbol,u.length?(l=u.filter(e=>e.currencyCode===d)[0].price,i=t(.177*l,!0)):(l=curr_availableRateplans.offerList.filter(e=>e.name===c)[0].rooms[0].averagePriceByCurrency.filter(e=>e.currencyCode===d)[0].price,i=t(.177*l,!0))}else if($("#multiroom_list").length)if(console.log("multi room card"),s.is($(".rate_cal_counter .multi_number"))){var g=0;s.closest(".room_card").find(".multi_number[price-data]").each(function(){g+=+$(this).attr("price-data")}),o=f_getCurrencyInfo().symbol,i=t(.177*g,!0)}else{c=s.closest(".room_card.card").find(".card_title").text().trim();var f=s.closest(".row").find(".col-md-5 strong").text().trim();d=f_getCurrencyInfo().code,u=curr_availableRateplans.filter(e=>e.name===c)[0].rooms.filter(e=>e.roomName===f)[0].discountedAveragePriceByCurrency;o=f_getCurrencyInfo().symbol,u.length?(l=u.filter(e=>e.currencyCode===d)[0].price,i=t(.177*l,!0)):(l=curr_availableRateplans.filter(e=>e.name===c)[0].rooms.filter(e=>e.roomName===f)[0].averagePriceByCurrency.filter(e=>e.currencyCode===d)[0].price,i=t(.177*l,!0)),s.attr("price-data",l)}else{console.log("room list");var m=s.closest(".room_card.card").find(".txt-black-five").text().replace(" - ","").trim();d=f_getCurrencyInfo().code,u=f_getSessionStorage().availableRooms.filter(e=>e.name===m)[0].discountedAveragePriceByCurrency;o=f_getCurrencyInfo().symbol,u.length?(l=u.filter(e=>e.currencyCode===d)[0].price,i=t(.177*l,!0)):(l=f_getSessionStorage().availableRooms.filter(e=>e.name===m)[0].averagePriceByCurrency.filter(e=>e.currencyCode===d)[0].price,i=t(.177*l,!0))}else o=s.text().slice(0,2),l=+s.text().slice(2).replace(/,/g,""),i=t(.177*l);n.push(o+i)}),console.log("taxArr:",n),i.forEach((e,t)=>{$(e).text("+"+n[t]+" avg. taxes & fees/night")})}function t(e,t=!1,r,a){var i=e;if(null==i||""===i)return"";"number"==typeof e&&(i=e.toString());var o=i.replace(/,/g,""),n=0===r&&-1===i.indexOf(".")?parseFloat(o):parseFloat(o).toFixed(2),l=/\B(?=(\d{3})+(?!\d))/g;if("SGD"===r)return n.toString().replace(l,",");if(t){var s=f_getSessionStorage().currency;if("IDR"===s)return parseFloat(n).toFixed().toString().replace(l,".");"KRW"!==s&&"JPY"!==s||(n=parseFloat(n).toFixed())}return a?n:n.toString().replace(l,",")}function r(){$(".mbs_button_primary").unbind("click.taxes"),$(".room_card .close_button").unbind("click.taxes"),DYO.waitForElementAsync(".mbs_button_primary").then(()=>{$(".mbs_button_primary").bind("click.taxes",()=>{l()})}),DYO.waitForElementAsync(".room_card .close_button").then(()=>{$(".room_card .close_button").bind("click.taxes",()=>{l()})})}function a(){var t=".pricePanel small",a=".room_price";e(t,a,!0),r()}function o(){g().then(()=>{var t=".packageList_item_pricing small",r=".packagePrice";e(t,r,!0),$(".radio_div.binded").length||s()})}function n(){var t=".room_card .multi_avg~div small",r=".multi_number";e(t,r,!0)}function l(){g().then(()=>{$("#select_room_container").length?o():$("#multiroom_list").length?n():a()})}function s(){$(".radio_div").unbind("click.taxes").removeClass("binded"),DYO.waitForElementAsync(".radio_div").then(()=>{$(".radio_div").bind("click.taxes",()=>{l()}),$(".radio_div").addClass("binded")})}function c(){$(".room_filters_dropdown:not(.dy-bath-filter) a+ul li").unbind("click.taxes"),$(".room_filters_dropdown.dy-bath-filter a+ul li input").unbind("click.taxes"),$(".currency_dropdown a+ul li").unbind("click.taxes"),$("#sort_by").unbind("click.taxes"),DYO.waitForElementAsync(".room_filters_dropdown:not(.dy-bath-filter) a+ul li").then(()=>{$(".room_filters_dropdown:not(.dy-bath-filter) a+ul li").bind("click.taxes",()=>{console.log("normal filter clicking"),l()})}),DYO.waitForElementAsync(".room_filters_dropdown.dy-bath-filter a+ul li input").then(()=>{$(".room_filters_dropdown.dy-bath-filter a+ul li input").bind("click.taxes",()=>{console.log("bath filter clicking"),l()})}),DYO.waitForElementAsync(".currency_dropdown a+ul li").then(()=>{$(".currency_dropdown a+ul li").bind("click.taxes",()=>{console.log("currency clicking"),l()})}),DYO.waitForElementAsync("#sort_by").then(()=>{$("#sort_by").bind("click.taxes",()=>{console.log("price-ordering clicking"),l()})})}function d(){var e=u("Rooms");if(e>1){var t=document.getElementById("multiRoomBanner_outlet"),a={attributes:!0,childList:!0,subtree:!0},i=function(e,t){for(let t of e)if("childList"===t.type){var a=t.addedNodes,i=t.removedNodes;($.inArray($(".banner_card_outlet")[0],a)>-1||$.inArray($(".banner_card_outlet")[0],i)>-1)&&setTimeout(()=>{l(),c(),r()},300)}},o=new MutationObserver(i);o.observe(t,a)}}function u(e){var t=window.location.search.substring(1),r=t.split("&");for(i=0;i<r.length;i++){var a=r[i].split("=")[0],o=r[i].split("=")[1];if(e==a)return o}}function g(){return new Promise((e,t)=>{setInterval(()=>{"none"==$("#loading").css("display")&&e()},100)})}function f(){DYO.waitForElementAsync(".calendar_box_tips span").then(()=>{$(".calendar_box_tips span").text("Rates are subject to GST and charges")})}function m(){$("#upgrade_dialog").find(".upgrade_body").on("click",".upgradeBlock",function(){var e=$(this).attr("data-index"),t=$(this).attr("data-room");$("#upgrade_dialog").attr("selected-data-index",e),$("#upgrade_dialog").attr("selected-data-room",t);var r=_(e,t).symbol,a=_(e,t).tax,i=_(e,t).taxOfUpgrade;$("#upgrade_rcontent_items_tax_tips").text("+"+r+a+" avg. taxes & fees/night"),$(".upgrade-tax-tip").length?$(".upgrade-tax-tip").text("+"+r+i+" avg. taxes & fees/night"):($(".upgradeCostNum").closest("span").after("<br/><small class='upgrade-tax-tip'>+"+r+i+" avg. taxes & fees/night</small>"),$(".upgradeCostNum").closest("div").css({display:"inline-block","text-align":"right"}))});var e=document.getElementById("upgrade_dialog"),t={attributes:!0,childList:!0,subtree:!0},r=function(t,r){for(let r of t)"attributes"==r.type&&"style"==r.attributeName&&r.target==e&&("block"==$("#upgrade_dialog").css("display")?$("#upgrade_dialog").hasClass("showed")||($("#upgrade_dialog .upgrade_body .upgradeBlock:eq(0)").trigger("click"),$(".upgradeBlock").each(function(){var e=$(this).attr("data-index"),t=$(this).attr("data-room"),r=_(e,t).taxOfUpgrade,a=_(e,t).symbol;$(this).find(".col-md-3").append("<div><small>+"+a+r+" avg. taxes & fees/night</small></div>")}),$("#upgrade").hasClass("binded")||$("#upgrade").addClass("binded").click(()=>{b()}),$("#upgrade_dialog").addClass("showed")):$("#upgrade_dialog").removeClass("showed"))},a=new MutationObserver(r);a.observe(e,t)}function _(e,r){var a=f_getSessionStorage().currency,i=f_getSessionStorage().symbol,o=f_getSessionStorage().upgradeRooms[r][e],n=o.costOfUpgrade.filter(e=>e.currencyCode===a)[0].price,l=o.discountedAveragePrice,s=o.averagePrice,c=null,d=null;return c=l.length?l.filter(e=>a==e.currencyCode)[0].price:s.filter(e=>a==e.currencyCode)[0].price,d=t(.177*c,!0),taxOfUpgrade=t(.177*n,!0),{symbol:i,tax:d,taxOfUpgrade:taxOfUpgrade}}function p(){return new Promise((e,t)=>{var r=setInterval(()=>{"none"!=$(".upgraded").css("display")&&(e(),clearInterval(r))},100)})}function b(){g().then(()=>p()).then(()=>{var e=$("#upgrade_dialog").attr("selected-data-index"),t=$("#upgrade_dialog").attr("selected-data-room"),r=_(e,t).symbol,a=_(e,t).taxOfUpgrade;$(".upgradedPrice").eq(t).closest("p").hasClass("updated")||$(".upgradedPrice").eq(t).closest("p").css("display","inline-block").addClass("updated").append("<small style='text-align:right'>+"+r+a+" avg. taxes & fees/night</small>")})}var y=window.location.href;if(y.indexOf("deals/rooms.html")>-1||y.indexOf("offers/rooms.html")>-1){var v=".bottomFix .big~br+small",h=".big strong";setTimeout(()=>{e(v,h)},100),$(".dropdown-menu-filter .checkbox input").click(()=>{setTimeout(()=>{e(v,h)},10)}),$(".dropdown-menu-filter .filter-clear").click(()=>{setTimeout(()=>{e(v,h)},10)})}else if(y.indexOf("deals/rooms/")>-1||y.indexOf("offers/rooms/")>-1){v=".big~br+small",h=".big strong";e(v,h)}else if(y.indexOf("booking/search")>-1)f();else if(y.indexOf("booking/rooms")>-1)var x=setInterval(()=>{var e=$(".inner_circle_step.shapeborder_selected_in");if(2==e.length){var t=setInterval(()=>{if(null!=f_getSessionStorage()&&"none"==$("#loading").css("display")){l(),r(),c(),d();var e=setInterval(()=>{$("#booking_information_edit").length&&($("#booking_information_edit").click(()=>{f();var e=f_getSessionStorage().checkindate,t=f_getSessionStorage().los,a=f_getSessionStorage().rooms,i=setInterval(()=>{$("#s_btn_view_rooms").length&&($("#s_btn_view_rooms").click(()=>{var i=setInterval(()=>{if(null!=f_getSessionStorage()&&"none"==$("#loading").css("display")){var o=$(".calendar_date_select").eq(0).attr("data-daydata"),n=$(".calendar_date_select_range").length+1,s=$("#rate_container_box .rate_item").length;e==o&&t==n&&a==s||(l(),r(),c(),d()),clearInterval(i)}},100)}),clearInterval(i))},100)}),clearInterval(e))},100);clearInterval(t)}},100);clearInterval(x)}},100);else y.indexOf("booking/multirooms")>-1?l():y.indexOf("booking/payment.html")>-1&&(DYO.waitForElementAsync("#room_info .edit_txt").then(()=>{$("#room_info .edit_txt").click(()=>{f()})}),m())});