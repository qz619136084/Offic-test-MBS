$(function(){async function e(e,r,a,i){var[n,o]=await Promise.all([DYO.waitForElementAsync(e),DYO.waitForElementAsync(r)]);$(n).text(a),o.forEach(function(e,r){var a=null,n=null,o=null,l=$(e);if(i)if($("#select_room_container").length){var s=l.closest(".packageList_item").find(".packageList_item_title").text().trim(),c=f_getCurrencyInfo().code,d=curr_availableRateplans.offerList.filter(e=>e.name===s)[0].rooms[0].discountedAveragePriceByCurrency;if(n=f_getCurrencyInfo().symbol,d.length){o=d.filter(e=>e.currencyCode===c)[0].price,a=t(1.177*o,!0);var u=l.closest(".packageList_item_pricing").find(".original_price"),f=curr_availableRateplans.offerList.filter(e=>e.name===s)[0].rooms[0].averagePriceByCurrency.filter(e=>e.currencyCode===c)[0].price,m=t(1.177*f,!0);u.text(n+m)}else o=curr_availableRateplans.offerList.filter(e=>e.name===s)[0].rooms[0].averagePriceByCurrency.filter(e=>e.currencyCode===c)[0].price,a=t(1.177*o,!0)}else if($("#multiroom_list").length)if(l.is($(".rate_cal_counter .multi_number"))){var g=0;l.closest(".room_card").find(".multi_number[price-data]").each(function(){g+=+$(this).attr("price-data")}),n=f_getCurrencyInfo().symbol,a=t(1.177*g,!0)}else{s=l.closest(".room_card.card").find(".card_title").text().trim();var p=l.closest(".row").find(".col-md-5 strong").text().trim();c=f_getCurrencyInfo().code,d=curr_availableRateplans.filter(e=>e.name===s)[0].rooms.filter(e=>e.roomName===p)[0].discountedAveragePriceByCurrency;if(n=f_getCurrencyInfo().symbol,d.length){o=d.filter(e=>e.currencyCode===c)[0].price,a=t(1.177*o,!0);u=l.closest(".row").find(".del_txt"),f=curr_availableRateplans.filter(e=>e.name===s)[0].rooms.filter(e=>e.roomName===p)[0].averagePriceByCurrency.filter(e=>e.currencyCode===c)[0].price,m=t(1.177*f,!0);u.text(n+m)}else o=curr_availableRateplans.filter(e=>e.name===s)[0].rooms.filter(e=>e.roomName===p)[0].averagePriceByCurrency.filter(e=>e.currencyCode===c)[0].price,a=t(1.177*o,!0);l.attr("price-data",o)}else{var _=l.closest(".room_card.card").find(".txt-black-five").text().replace(" - ","").trim();c=f_getCurrencyInfo().code,d=f_getSessionStorage().availableRooms.filter(e=>e.name===_)[0].discountedAveragePriceByCurrency;if(n=f_getCurrencyInfo().symbol,d.length){o=d.filter(e=>e.currencyCode===c)[0].price,a=t(1.177*o,!0);u=l.closest(".pricePanel").find(".original_price"),f=f_getSessionStorage().availableRooms.filter(e=>e.name===_)[0].averagePriceByCurrency.filter(e=>e.currencyCode===c)[0].price,m=t(1.177*f,!0);u.text(n+m)}else o=f_getSessionStorage().availableRooms.filter(e=>e.name===_)[0].averagePriceByCurrency.filter(e=>e.currencyCode===c)[0].price,a=t(1.177*o,!0)}else n=l.text().slice(0,2),null==l.attr("priceWithTax")||""==l.attr("priceWithTax")?(o=+l.text().slice(2).replace(/,/g,""),a=t(1.177*o),l.attr("priceWithTax",a)):a=l.attr("priceWithTax");l.text(n+a)}),$("body").removeClass("noFlicker")}function t(e,t=!1,r,a){var i=e;if(null==i||""===i)return"";"number"==typeof e&&(i=e.toString());var n=i.replace(/,/g,""),o=0===r&&-1===i.indexOf(".")?parseFloat(n):parseFloat(n).toFixed(2),l=/\B(?=(\d{3})+(?!\d))/g;if("SGD"===r)return o.toString().replace(l,",");if(t){var s=f_getSessionStorage().currency;if("IDR"===s)return parseFloat(o).toFixed().toString().replace(l,".");"KRW"!==s&&"JPY"!==s||(o=parseFloat(o).toFixed())}return a?o:o.toString().replace(l,",")}function r(){$(".mbs_button_primary").unbind("click.taxes"),$(".room_card .close_button").unbind("click.taxes"),DYO.waitForElementAsync(".mbs_button_primary").then(()=>{$(".mbs_button_primary").bind("click.taxes",()=>{l()})}),DYO.waitForElementAsync(".room_card .close_button").then(()=>{$(".room_card .close_button").bind("click.taxes",()=>{l()})})}function a(){var t=".pricePanel small",a=".room_price";e(t,a,C,!0),r()}function n(){f().then(()=>{var t=".packageList_item_pricing small",r=".packagePrice";e(t,r,C,!0),$(".radio_div.binded").length||s()})}function o(){var t=".room_card .multi_avg~div small",r=".multi_number";e(t,r,C,!0)}function l(){$("body").addClass("noFlicker"),f().then(()=>{$("#select_room_container").length?n():$("#multiroom_list").length?o():a()})}function s(){$(".radio_div").unbind("click.taxes").removeClass("binded"),DYO.waitForElementAsync(".radio_div").then(()=>{$(".radio_div").bind("click.taxes",()=>{l()}),$(".radio_div").addClass("binded")})}function c(){$(".room_filters_dropdown:not(.dy-bath-filter) a+ul li").unbind("click.taxes"),$(".room_filters_dropdown.dy-bath-filter a+ul li input").unbind("click.taxes"),$(".currency_dropdown a+ul li").unbind("click.taxes"),$("#sort_by").unbind("click.taxes"),DYO.waitForElementAsync(".room_filters_dropdown:not(.dy-bath-filter) a+ul li").then(()=>{$(".room_filters_dropdown:not(.dy-bath-filter) a+ul li").bind("click.taxes",()=>{l()})}),DYO.waitForElementAsync(".room_filters_dropdown.dy-bath-filter a+ul li input").then(()=>{$(".room_filters_dropdown.dy-bath-filter a+ul li input").bind("click.taxes",()=>{l()})}),DYO.waitForElementAsync(".currency_dropdown a+ul li").then(()=>{$(".currency_dropdown a+ul li").bind("click.taxes",()=>{l()})}),DYO.waitForElementAsync("#sort_by").then(()=>{$("#sort_by").bind("click.taxes",()=>{l()})})}function d(){var e=u("Rooms");if(e>1){var t=document.getElementById("multiRoomBanner_outlet"),a={attributes:!0,childList:!0,subtree:!0},i=function(e,t){for(let t of e)if("childList"===t.type){var a=t.addedNodes,i=t.removedNodes;($.inArray($(".banner_card_outlet")[0],a)>-1||$.inArray($(".banner_card_outlet")[0],i)>-1)&&setTimeout(()=>{l(),c(),r()},300)}},n=new MutationObserver(i);n.observe(t,a)}}function u(e){var t=window.location.search.substring(1),r=t.split("&");for(i=0;i<r.length;i++){var a=r[i].split("=")[0],n=r[i].split("=")[1];if(e==a)return n}}function f(){return new Promise((e,t)=>{var r=setInterval(()=>{"none"==$("#loading").css("display")&&(e(),clearInterval(r))},100)})}function m(){1==$(".calendar_date_select").length&&$(".isCheckOutDate .housePrice").removeClass("updated"),$(".housePrice").each(function(){if(!$(this).hasClass("updated")){var e=$(this).text().trim().slice(0,2),t=$(this).text().trim().slice(2);if(t.length&&/[0-9]+/.test($(this).text().trim())){var r=(1.177*t).toFixed();$(this).text(e+r),$(this).addClass("updated")}}})}function g(e,t){var r=null;return function(){clearTimeout(r),r=setTimeout(function(){e()},t)}}function p(){f().then(()=>{m(),$(".calendar_box_tips span").text("Rates shown in S$ inclusive of GST and charges");var e=document.querySelectorAll("#calendar")[0];e.onscroll=g(m,50),e.onclick=g(m,50)})}function _(e){$("#upgrade_dialog").find(".upgrade_body").on("click",".upgradeBlock",function(){var t=$(this).attr("data-index"),r=$(this).attr("data-room");$("#upgrade_dialog").attr("selected-data-index",t),$("#upgrade_dialog").attr("selected-data-room",r);var a=h(t,r).symbol,i=h(t,r).priceWithTax,n=h(t,r).costOfUpgradeWithTax;$(".upgrade_rcontent_items span b").css("opacity","0"),$(".upgradeCostNum").css("opacity","0"),setTimeout(()=>{$(".upgrade_rcontent_items span b").text(a+i),$(".upgrade_rcontent_items span b").css("opacity","1"),$(".upgradeCostNum").text("+"+a+n+"/night"),$(".upgradeCostNum").css("opacity","1")},10),$("#upgrade_rcontent_items_tax_tips").text(e),$(".upgrade-tax-tip").length||($(".upgradeCostNum").closest("span").after("<br/><small class='upgrade-tax-tip'>"+e+"</small>"),$(".upgradeCostNum").closest("div").css({display:"inline-block","text-align":"right"}))});var t=document.getElementById("upgrade_dialog"),r={attributes:!0,childList:!0,subtree:!0},a=function(r,a){for(let a of r)"attributes"==a.type&&"style"==a.attributeName&&a.target==t&&("block"==$("#upgrade_dialog").css("display")?$("#upgrade_dialog").hasClass("showed")||($("#upgrade_dialog .upgrade_body .upgradeBlock:eq(0)").trigger("click"),$(".upgradeBlock").each(function(){var t=$(this).attr("data-index"),r=$(this).attr("data-room"),a=h(t,r).costOfUpgradeWithTax,i=h(t,r).symbol;$(this).find(".col-md-3").append("<div><small>"+e+"</small></div>"),$(this).find(".col-md-3 span:eq(0)").text("+"+i+a)}),$("#upgrade").hasClass("binded")||$("#upgrade").addClass("binded").click(()=>{b(e)}),$("#upgrade_dialog").addClass("showed")):($("#upgrade_dialog").removeClass("showed"),y()))},i=new MutationObserver(a);i.observe(t,r),y()}function h(e,r){var a=f_getSessionStorage().currency,i=f_getSessionStorage().symbol,n=f_getSessionStorage().upgradeRooms[r][e],o=n.costOfUpgrade.filter(e=>e.currencyCode===a)[0].price,l=n.discountedAveragePrice,s=n.upgradePriceByDefaultCurrency,c=n.averagePrice,d=null,u=null;return d=l.length?l.filter(e=>a==e.currencyCode)[0].price:c.filter(e=>a==e.currencyCode)[0].price,u=t(1.177*d,!0),costOfUpgradeWithTax=t(1.177*o,!0),defaultUpgradePriceWithTax=t(1.177*s,!0),{symbol:i,priceWithTax:u,costOfUpgradeWithTax:costOfUpgradeWithTax,defaultUpgradePriceWithTax:defaultUpgradePriceWithTax}}function v(){return new Promise((e,t)=>{var r=setInterval(()=>{"none"!=$(".upgraded").css("display")&&(e(),clearInterval(r))},100)})}function b(e){f().then(()=>v()).then(()=>{var t=$("#upgrade_dialog").attr("selected-data-index"),r=$("#upgrade_dialog").attr("selected-data-room"),a=h(t,r).symbol,i=h(t,r).costOfUpgradeWithTax;$(".upgradedPrice").eq(r).text(a+i),$(".upgradedPrice").eq(r).closest("p").hasClass("updated")||$(".upgradedPrice").eq(r).closest("p").css("display","inline-block").addClass("updated").append("<small style='text-align:right'>"+e+"</small>")})}function y(){x().then(()=>DYO.waitForElementAsync(".no_upgrade b")).then(()=>{$(".no_upgrade b").each(function(){var e=$(this);if(!e.hasClass("updated")){var t=e.closest(".no_upgrade").attr("data-item"),r=h(0,t).symbol,a=h(0,t).defaultUpgradePriceWithTax;$(this).text(r+a+"++").addClass("updated")}})})}function x(){return new Promise((e,t)=>{var r=setInterval(()=>{null!=f_getSessionStorage()&&0!=Object.keys(f_getSessionStorage()).length&&(e(),clearInterval(r))},100)})}function k(e){$("body").addClass("noFlicker"),new Promise(e=>{var t=setInterval(()=>{$(".ui-datepicker-group").hasClass("updated")||(e(),clearInterval(t))},10)}).then(()=>{$(".day-rate").each(function(){var e=$(this).text().trim().slice(0,2),t=$(this).text().trim().slice(2);if(t.length&&/[0-9]+/.test($(this).text().trim())){var r=(1.177*t).toFixed();$(this).text(e+r)}}),$(".ui-datepicker-group").addClass("updated"),$("body").removeClass("noFlicker")}),e&&$("body").removeClass("noFlicker")}var C="Inclusive of GST and charges",w=window.location.href;if(w.indexOf("deals/rooms.html")>-1||w.indexOf("offers/rooms.html")>-1){var S=".bottomFix .big~br+small",O=".bottomFix .big strong";setTimeout(()=>{e(S,O,C)},100),$(".dropdown-menu-filter .checkbox input").click(()=>{setTimeout(()=>{e(S,O,C)},10)}),$(".dropdown-menu-filter .filter-clear").click(()=>{setTimeout(()=>{e(S,O,C)},10)})}else if(w.indexOf("deals/rooms/")>-1||w.indexOf("offers/rooms/")>-1){S=".big~br+small",O=".big strong";e(S,O,C)}else if(w.indexOf("booking/search")>-1)p();else if(w.indexOf("booking/rooms")>-1)var I=setInterval(()=>{var e=$(".inner_circle_step.shapeborder_selected_in");if(2==e.length){var t=setInterval(()=>{if(null!=f_getSessionStorage()&&"none"==$("#loading").css("display")){l(),r(),c(),d();var e=setInterval(()=>{$("#booking_information_edit").length&&($("#booking_information_edit").click(()=>{p();var e=f_getSessionStorage().checkindate,t=f_getSessionStorage().los,a=f_getSessionStorage().rooms,i=setInterval(()=>{$("#s_btn_view_rooms").length&&($("#s_btn_view_rooms").click(()=>{var i=setInterval(()=>{if(null!=f_getSessionStorage()&&"none"==$("#loading").css("display")){var n=$(".calendar_date_select").eq(0).attr("data-daydata"),o=$(".calendar_date_select_range").length+1,s=$("#rate_container_box .rate_item").length;e==n&&t==o&&a==s||(l(),r(),c(),d()),clearInterval(i)}},100)}),clearInterval(i))},100)}),clearInterval(e))},100);clearInterval(t)}},100);clearInterval(I)}},100);else w.indexOf("booking/multirooms")>-1?l():w.indexOf("booking/payment.html")>-1&&(DYO.waitForElementAsync("#room_info .edit_txt").then(()=>{$("#room_info .edit_txt").click(()=>{p(),DYO.waitForElementAsync("#s_btn_view_rooms").then(()=>{$("#s_btn_view_rooms").click(()=>{f().then(()=>{y()})})})})}),_(C));$(".date-selector").click(function(){new Promise(e=>{var t=setInterval(()=>{"none"==$(".loading").css("display")&&(e(),clearInterval(t))},100)}).then(()=>{k(1),$(".datepicker-range-top span").text("Rates shown in S$ inclusive of GST and charges")})}),$(document).mousedown(()=>{$(document).mouseup(e=>{$(e.target).closest(".datepicker-container").length&&k(),$(document).unbind("mouseup")})})});